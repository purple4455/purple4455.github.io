<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Period 4 with 2048 Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 20px;
        }
        .timer {
            font-size: 24px;
            margin-bottom: 20px;
        }
        .grid-container {
            display: grid;
            grid-template-columns: repeat(4, 100px);
            grid-template-rows: repeat(4, 100px);
            gap: 10px;
            justify-content: center;
        }
        .grid-item {
            width: 100px;
            height: 100px;
            background-color: #eee;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
        .game-container {
            margin-top: 20px;
        }
    </style>
</head>
<body>

    <h1>Period 4</h1>
    <div class="timer">
        <p id="timeRemaining"></p>
        <p id="percentComplete"></p>
    </div>

    <div class="game-container">
        <h2>2048 Game</h2>
        <div class="grid-container" id="grid"></div>
    </div>

    <script>
        // Lunch Timer Logic
        const lunch = 1727287800000;
        let timeGap;

        function updateTimer() {
            const now = Date.now();
            let lunchTime = lunch;

            while (lunchTime < now) {
                lunchTime += 86400000; // Add a day in milliseconds
            }

            timeGap = lunchTime - now;
            const oldTime = now;

            function runTimer() {
                const currentTime = Date.now();
                const remainingTime = lunchTime - currentTime;
                const percentComplete = ((currentTime - oldTime) / timeGap) * 100;
                const remainingSeconds = (remainingTime / 1000).toFixed(3);

                document.getElementById('timeRemaining').innerHTML = `${remainingSeconds}`;
                document.getElementById('percentComplete').innerHTML = `${percentComplete.toFixed(3)}%`;

                if (remainingTime <= 0) {
                    document.getElementById('timeRemaining').innerHTML = "BANG";
                    clearInterval(interval);
                }
            }

            const interval = setInterval(runTimer, 1);
        }

        updateTimer();

        // 2048 Game Logic
        const gridDisplay = document.getElementById('grid');
        let squares = [];

        // Create the playing board
        function createBoard() {
            for (let i = 0; i < 16; i++) {
                const square = document.createElement('div');
                square.classList.add('grid-item');
                square.innerHTML = 0;
                gridDisplay.appendChild(square);
                squares.push(square);
            }
            generate();
            generate();
        }

        // Generate a number randomly
        function generate() {
            let randomNumber = Math.floor(Math.random() * squares.length);
            if (squares[randomNumber].innerHTML == 0) {
                squares[randomNumber].innerHTML = 2;
                checkForGameOver();
            } else generate();
        }

        // Swipe right
        function moveRight() {
            for (let i = 0; i < 16; i++) {
                if (i % 4 === 0) {
                    let row = [
                        parseInt(squares[i].innerHTML),
                        parseInt(squares[i + 1].innerHTML),
                        parseInt(squares[i + 2].innerHTML),
                        parseInt(squares[i + 3].innerHTML)
                    ];

                    let filteredRow = row.filter(num => num);
                    let missing = 4 - filteredRow.length;
                    let zeros = Array(missing).fill(0);
                    let newRow = zeros.concat(filteredRow);

                    squares[i].innerHTML = newRow[0];
                    squares[i + 1].innerHTML = newRow[1];
                    squares[i + 2].innerHTML = newRow[2];
                    squares[i + 3].innerHTML = newRow[3];
                }
            }
        }

        // Swipe left
        function moveLeft() {
            for (let i = 0; i < 16; i++) {
                if (i % 4 === 0) {
                    let row = [
                        parseInt(squares[i].innerHTML),
                        parseInt(squares[i + 1].innerHTML),
                        parseInt(squares[i + 2].innerHTML),
                        parseInt(squares[i + 3].innerHTML)
                    ];

                    let filteredRow = row.filter(num => num);
                    let missing = 4 - filteredRow.length;
                    let zeros = Array(missing).fill(0);
                    let newRow = filteredRow.concat(zeros);

                    squares[i].innerHTML = newRow[0];
                    squares[i + 1].innerHTML = newRow[1];
                    squares[i + 2].innerHTML = newRow[2];
                    squares[i + 3].innerHTML = newRow[3];
                }
            }
        }

        // Swipe down
        function moveDown() {
            for (let i = 0; i < 4; i++) {
                let column = [
                    parseInt(squares[i].innerHTML),
                    parseInt(squares[i + 4].innerHTML),
                    parseInt(squares[i + 8].innerHTML),
                    parseInt(squares[i + 12].innerHTML)
                ];

                let filteredColumn = column.filter(num => num);
                let missing = 4 - filteredColumn.length;
                let zeros = Array(missing).fill(0);
                let newColumn = zeros.concat(filteredColumn);

                squares[i].innerHTML = newColumn[0];
                squares[i + 4].innerHTML = newColumn[1];
                squares[i + 8].innerHTML = newColumn[2];
                squares[i + 12].innerHTML = newColumn[3];
            }
        }

        // Swipe up
        function moveUp() {
            for (let i = 0; i < 4; i++) {
                let column = [
                    parseInt(squares[i].innerHTML),
                    parseInt(squares[i + 4].innerHTML),
                    parseInt(squares[i + 8].innerHTML),
                    parseInt(squares[i + 12].innerHTML)
                ];

                let filteredColumn = column.filter(num => num);
                let missing = 4 - filteredColumn.length;
                let zeros = Array(missing).fill(0);
                let newColumn = filteredColumn.concat(zeros);

                squares[i].innerHTML = newColumn[0];
                squares[i + 4].innerHTML = newColumn[1];
                squares[i + 8].innerHTML = newColumn[2];
                squares[i + 12].innerHTML = newColumn[3];
            }
        }

        // Combine rows
        function combineRow() {
            for (let i = 0; i < 15; i++) {
                if (squares[i].innerHTML === squares[i + 1].innerHTML) {
                    let combinedTotal = parseInt(squares[i].innerHTML) + parseInt(squares[i + 1].innerHTML);
                    squares[i].innerHTML = combinedTotal;
                    squares[i + 1].innerHTML = 0;
                }
            }
        }

        // Combine columns
        function combineColumn() {
            for (let i = 0; i < 12; i++) {
                if (squares[i].innerHTML === squares[i + 4].innerHTML) {
                    let combinedTotal = parseInt(squares[i].innerHTML) + parseInt(squares[i + 4].innerHTML);
                    squares[i].innerHTML = combinedTotal;
                    squares[i + 4].innerHTML = 0;
                }
            }
        }

        // Assign keycodes to functions
        function control(e) {
            if (e.keyCode === 39) {
                keyRight();
            } else if (e.keyCode === 37) {
                keyLeft();
            } else if (e.keyCode === 38) {
                keyUp();
            } else if (e.keyCode === 40) {
                keyDown();
            }
        }
        document.addEventListener('keyup', control);

        function keyRight() {
            moveRight();
            combineRow();
            moveRight();
            generate();
        }

        function keyLeft() {
            moveLeft();
            combineRow();
            moveLeft();
            generate();
        }

        function keyDown() {
            moveDown();
            combineColumn();
            moveDown();
            generate();
        }

        function keyUp() {
            moveUp();
            combineColumn();
            moveUp();
            generate();
        }

        function checkForGameOver() {
            let zeros = 0;
            for (let i = 0; i < squares.length; i++) {
                if (squares[i].innerHTML == 0) {
                    zeros++;
                }
            }
            if (zeros === 0)
